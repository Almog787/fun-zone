<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMERGENCY RADAR | Global Crisis Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Orbitron:wght@400;900&display=swap');
        
        :root {
            --emergency-red: #ff0000;
            --radar-green: #00ff41;
            --bg-dark: #050505;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--radar-green);
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            height: 100vh;
        }

        .orbitron { font-family: 'Orbitron', sans-serif; }

        .panel {
            background: rgba(10, 10, 10, 0.9);
            border: 1px solid rgba(0, 255, 65, 0.2);
            box-shadow: inset 0 0 15px rgba(0, 255, 65, 0.05);
        }

        #map {
            height: 100%;
            width: 100%;
            filter: invert(100%) hue-rotate(180deg) brightness(0.6) contrast(1.2);
        }

        .emergency-pulse {
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); border-color: #ff0000; }
            70% { box-shadow: 0 0 0 15px rgba(255, 0, 0, 0); border-color: #7f0000; }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); border-color: #ff0000; }
        }

        .scanline {
            width: 100%; height: 2px; background: rgba(0, 255, 65, 0.1);
            position: absolute; z-index: 100; pointer-events: none;
            animation: scan 4s linear infinite;
        }
        @keyframes scan { from { top: 0; } to { top: 100%; } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--radar-green); }
    </style>
</head>
<body class="flex flex-col">
    <div class="scanline"></div>

    <!-- Top Status Bar -->
    <header class="h-14 panel flex justify-between items-center px-6 border-b border-green-900/50">
        <div class="flex items-center gap-4">
            <i class="fas fa-radiation text-red-500 animate-spin-slow"></i>
            <h1 class="orbitron text-lg font-black tracking-[0.2em] text-white">EMERGENCY <span class="text-red-600">RADAR</span></h1>
        </div>
        <div class="flex items-center gap-8 text-[10px] font-bold">
            <div id="air-status">AIRCRAFT_SQUAWK: <span class="text-white font-mono">SCANNING...</span></div>
            <div id="seismic-status">SEISMIC_UNITS: <span class="text-white font-mono">ACTIVE</span></div>
            <div id="clock" class="orbitron text-sm text-green-400">00:00:00</div>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden">
        
        <!-- Sidebar: Crisis Feed -->
        <aside class="w-80 panel border-r border-green-900/30 flex flex-col z-50">
            <div class="p-4 border-b border-green-900/30 bg-green-900/10">
                <h2 class="text-xs font-black uppercase tracking-widest flex justify-between">
                    <span>Live_Event_Log</span>
                    <span class="text-red-500 animate-pulse">REC</span>
                </h2>
            </div>
            
            <div id="event-feed" class="flex-1 overflow-y-auto p-4 space-y-4 text-[10px]">
                <!-- Crisis events will be injected here -->
                <p class="opacity-40 italic">> Initializing global sensor grid...</p>
            </div>

            <!-- Language Switcher -->
            <div class="p-4 border-t border-green-900/30 grid grid-cols-2 gap-2">
                <button onclick="setLang('en')" class="bg-green-900/20 hover:bg-green-900/40 p-2 rounded text-[10px] font-bold transition">ENGLISH</button>
                <button onclick="setLang('he')" class="bg-green-900/20 hover:bg-green-900/40 p-2 rounded text-[10px] font-bold transition font-sans">עברית</button>
            </div>
        </aside>

        <!-- Main Map Area -->
        <main class="flex-1 relative">
            <div id="map"></div>
            
            <!-- Bottom HUD Overlay -->
            <div class="absolute bottom-6 left-6 p-4 panel rounded-lg pointer-events-none z-[1000] border-l-4 border-red-600">
                <div class="text-[9px] font-bold uppercase mb-1">Alert_Priority_Level</div>
                <div class="text-xl orbitron font-black text-red-500 uppercase tracking-tighter">Code Red / Squawk 7700</div>
                <div class="text-[8px] opacity-60 mt-1 uppercase">Automated Satellite Intercept Active</div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- Initialization ---
        const map = L.map('map', { zoomControl: false }).setView([20, 0], 2);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        let markers = [];
        let currentLang = 'en';

        const i18n = {
            en: { title: "EMERGENCY RADAR", aircraft: "AIRCRAFT_SQUAWK", seismic: "SEISMIC_UNITS", dir: "ltr" },
            he: { title: "מכ\"ם חירום", aircraft: "מטוסי במצוקה", seismic: "פעילות סיסמית", dir: "rtl" }
        };

        function setLang(lang) {
            currentLang = lang;
            document.documentElement.dir = i18n[lang].dir;
            updateEvents(); // Re-render feed
        }

        // --- Clock ---
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toTimeString().split(' ')[0];
        }, 1000);

        // --- OpenSky API (Aircraft in Emergency) ---
        async function fetchEmergencyPlanes() {
            const feed = document.getElementById('event-feed');
            const status = document.getElementById('air-status');
            
            try {
                // OpenSky API - Fetching all planes.
                // In a real scenario, we'd filter for Squawk 7700.
                const res = await fetch('https://opensky-network.org/api/states/all');
                const data = await res.json();
                
                // Filter planes with squawk 7700 (General Emergency)
                const emergencies = data.states.filter(s => s[14] === "7700");
                
                if(emergencies.length > 0) {
                    status.innerHTML = `AIRCRAFT_SQUAWK: <span class="text-red-500 animate-pulse">${emergencies.length} ACTIVE</span>`;
                    emergencies.forEach(plane => {
                        addEvent('AIRCRAFT_EMERGENCY', `Flight ${plane[1]} (Callsign) reported Squawk 7700. Location: ${plane[6]}, ${plane[5]}`, 'red');
                        addMapMarker(plane[6], plane[5], `EMERGENCY: ${plane[1]}`, 'red');
                    });
                } else {
                    status.innerHTML = `AIRCRAFT_SQUAWK: <span class="text-blue-400">0 DETECTED</span>`;
                }
            } catch (e) {
                console.error("OpenSky Signal Lost");
            }
        }

        // --- USGS API (Earthquakes) ---
        async function fetchEarthquakes() {
            try {
                const res = await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_day.geojson');
                const data = await res.json();
                
                data.features.slice(0, 5).forEach(q => {
                    const mag = q.properties.mag;
                    const place = q.properties.place;
                    const coords = q.geometry.coordinates;
                    
                    addEvent('SEISMIC_EVENT', `Magnitude ${mag} earthquake detected near ${place}.`, mag > 6 ? 'red' : 'orange');
                    addMapMarker(coords[1], coords[0], `QUAKE: ${mag} - ${place}`, mag > 6 ? 'red' : 'orange');
                });
            } catch (e) {
                console.error("Seismic Grid Offline");
            }
        }

        // --- UI Helpers ---
        function addEvent(type, msg, color) {
            const feed = document.getElementById('event-feed');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = color === 'red' ? 'text-red-500' : 'text-orange-500';
            
            const div = document.createElement('div');
            div.className = `p-2 border-l-2 ${color === 'red' ? 'border-red-600 bg-red-900/10' : 'border-orange-600 bg-orange-900/10'} mb-2 fade-in`;
            div.innerHTML = `
                <div class="flex justify-between font-black mb-1">
                    <span class="${colorClass}">[${type}]</span>
                    <span class="opacity-50">${timestamp}</span>
                </div>
                <div class="opacity-80">${msg}</div>
            `;
            feed.prepend(div);
        }

        function addMapMarker(lat, lng, title, color) {
            const markerColor = color === 'red' ? '#ff0000' : '#ffa500';
            const marker = L.circleMarker([lat, lng], {
                radius: 10,
                fillColor: markerColor,
                color: "#fff",
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8,
                className: color === 'red' ? 'emergency-pulse' : ''
            }).addTo(map).bindPopup(title);
            
            markers.push(marker);
        }

        // --- Run App ---
        fetchEmergencyPlanes();
        fetchEarthquakes();
        setInterval(fetchEmergencyPlanes, 30000); // 30s refresh
        setInterval(fetchEarthquakes, 60000); // 60s refresh
    </script>
</body>
</html>
