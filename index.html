<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת ניטור גלובלית - Windy & NASA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@200;400;700;800&family=Orbitron:wght@400;900&display=swap');
        
        body { 
            font-family: 'Assistant', sans-serif; 
            background-color: #05070a; 
            color: #e2e8f0;
            overflow: hidden;
            height: 100vh;
        }

        .orbitron { font-family: 'Orbitron', sans-serif; }

        /* עיצוב חדר בקרה */
        .panel {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(51, 65, 85, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 12px;
        }

        .screen-glow {
            box-shadow: inset 0 0 20px rgba(37, 99, 235, 0.1), 0 0 15px rgba(0, 0, 0, 0.5);
        }

        /* סרגל גלילה מעוצב */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        .live-tag {
            animation: blink 1.5s infinite;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        iframe { border-radius: 8px; }
    </style>
</head>
<body class="p-4 flex flex-col gap-4">

    <!-- Header -->
    <header class="flex justify-between items-center bg-slate-900/80 p-4 rounded-2xl border border-slate-800 shadow-2xl">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-900/20">
                <i class="fas fa-satellite-dish text-2xl text-white"></i>
            </div>
            <div>
                <h1 class="orbitron text-xl font-black tracking-widest text-blue-400">GLOBAL <span class="text-white">COMMAND</span></h1>
                <p class="text-[10px] uppercase tracking-[0.4em] text-slate-500 font-bold">Satellite & Ground Surveillance System</p>
            </div>
        </div>
        
        <div class="flex items-center gap-6">
            <div class="hidden md:block text-left">
                <div id="live-clock" class="orbitron text-lg font-bold text-white">00:00:00</div>
                <div class="text-[9px] text-blue-500 font-bold uppercase text-right">System Local Time</div>
            </div>
            <button onclick="openSettings()" class="p-3 hover:bg-slate-800 rounded-full transition">
                <i class="fas fa-cog text-slate-400"></i>
            </button>
        </div>
    </header>

    <!-- Main Grid -->
    <div class="flex-1 grid grid-cols-1 lg:grid-cols-4 gap-4 overflow-hidden">
        
        <!-- Left Column: NASA & Space -->
        <div class="lg:col-span-3 flex flex-col gap-4 overflow-hidden">
            
            <!-- Main Monitor (NASA Live) -->
            <div class="flex-1 panel p-2 flex flex-col screen-glow relative">
                <div class="flex justify-between items-center p-2">
                    <span class="text-[10px] font-black uppercase text-blue-400 tracking-tighter">
                        <i class="fas fa-rocket mr-1"></i> Feed: NASA_TV_ISS_STREAM
                    </span>
                    <span class="text-red-500 text-[10px] font-bold live-tag">
                        ● LIVE CONNECTION
                    </span>
                </div>
                <div class="flex-1 bg-black rounded-lg overflow-hidden relative">
                    <!-- NASA Live YouTube Feed -->
                    <iframe class="absolute inset-0 w-full h-full" 
                        src="https://www.youtube.com/embed/jPTD2gnZFUw?autoplay=1&mute=1&controls=0&modestbranding=1" 
                        title="NASA Live" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                    
                    <!-- Overlay Data -->
                    <div class="absolute top-4 left-4 p-2 bg-black/40 text-[9px] font-mono rounded border border-white/10 pointer-events-none">
                        LAT: <span id="mock-lat">0.000</span><br>
                        LNG: <span id="mock-lng">0.000</span><br>
                        ALT: 408 KM
                    </div>
                </div>
            </div>

            <!-- Bottom: Windy Webcams Israel Selection -->
            <div class="h-1/3 panel p-4 flex flex-col gap-3">
                <h3 class="text-xs font-bold uppercase text-slate-500 border-b border-slate-800 pb-2">Ground Units: Israel Region</h3>
                <div id="israel-cams" class="flex-1 grid grid-cols-2 md:grid-cols-4 gap-4 overflow-y-auto pr-2">
                    <!-- Windy Israel Cameras will load here -->
                    <div class="animate-pulse bg-slate-800 rounded-lg"></div>
                    <div class="animate-pulse bg-slate-800 rounded-lg"></div>
                    <div class="animate-pulse bg-slate-800 rounded-lg"></div>
                    <div class="animate-pulse bg-slate-800 rounded-lg"></div>
                </div>
            </div>
        </div>

        <!-- Right Column: Windy Search & Global Cams -->
        <aside class="panel flex flex-col overflow-hidden shadow-2xl">
            <div class="p-4 border-b border-slate-800 bg-slate-900/50">
                <h3 class="orbitron text-xs font-bold text-blue-400 mb-4">GLOBAL SEARCH</h3>
                <div class="relative">
                    <input type="text" id="cam-search" placeholder="Enter City/Country..." 
                        class="w-full bg-slate-950 border border-slate-700 rounded-xl p-3 pl-10 text-xs focus:border-blue-500 outline-none transition shadow-inner">
                    <i class="fas fa-search absolute left-3 top-3.5 text-slate-500"></i>
                </div>
            </div>

            <div id="search-results" class="flex-1 overflow-y-auto p-4 space-y-4">
                <!-- Search results injected here -->
                <div class="text-center p-10 text-slate-600 text-xs italic">
                    Search for a location to view live ground feeds
                </div>
            </div>
        </aside>

    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-[2000]">
        <div class="panel w-full max-w-md p-8 shadow-2xl border-blue-500/30">
            <h2 class="orbitron text-lg font-bold text-white mb-4">API CONFIGURATION</h2>
            <p class="text-xs text-slate-400 mb-6 leading-relaxed">
                כדי להשתמש בחיפוש מצלמות מלא של Windy, עליך להזין מפתח API. <br>
                ניתן להשיג מפתח חינם בכתובת: <a href="https://api.windy.com/" class="text-blue-400 underline">api.windy.com</a>
            </p>
            <input type="text" id="windy-key" placeholder="Enter Windy API Key..." 
                class="w-full bg-black border border-slate-700 rounded-lg p-3 text-sm mb-4 outline-none focus:border-blue-500">
            <div class="flex gap-2">
                <button onclick="saveSettings()" class="flex-1 bg-blue-600 text-white py-2 rounded-lg font-bold">שמור</button>
                <button onclick="closeSettings()" class="flex-1 bg-slate-700 text-white py-2 rounded-lg font-bold">סגור</button>
            </div>
        </div>
    </div>

    <script>
        // --- מצב המערכת ---
        let WINDY_KEY = localStorage.getItem('windy_api_key') || "";
        
        // --- שעון מערכת ---
        function updateClock() {
            const now = new Date();
            document.getElementById('live-clock').innerText = now.toTimeString().split(' ')[0];
            // Mock GPS data
            document.getElementById('mock-lat').innerText = (Math.random() * 180 - 90).toFixed(3);
            document.getElementById('mock-lng').innerText = (Math.random() * 360 - 180).toFixed(3);
        }
        setInterval(updateClock, 1000);

        // --- Windy API: מצלמות בישראל ---
        // הערה: בגלל שאין מפתח כברירת מחדל, נשתמש ב-Embeds ציבוריים מוגדרים מראש
        async function loadIsraelCams() {
            const container = document.getElementById('israel-cams');
            
            // רשימת מצלמות מעניינות בישראל (IDs מ-Windy/Webcams.travel)
            const israelFeeds = [
                { title: "Tel Aviv Beach", id: "1356079977" },
                { title: "Jerusalem Old City", id: "1515286542" },
                { title: "Eilat Marina", id: "1488667500" },
                { title: "Haifa Port", id: "1172828210" }
            ];

            container.innerHTML = israelFeeds.map(cam => `
                <div class="relative group cursor-pointer overflow-hidden rounded-lg border border-slate-800 bg-black aspect-video shadow-lg">
                    <iframe class="w-full h-full opacity-70 group-hover:opacity-100 transition" 
                        src="https://webcams.windy.com/webcams/public/embed/player/${cam.id}/day" 
                        frameborder="0"></iframe>
                    <div class="absolute bottom-0 left-0 right-0 p-1 bg-black/60 text-[8px] font-bold text-center uppercase tracking-widest text-blue-400">
                        ${cam.title}
                    </div>
                </div>
            `).join('');
        }

        // --- חיפוש מצלמות (דורש מפתח API) ---
        async function searchCameras() {
            const query = document.getElementById('cam-search').value;
            if (query.length < 3) return;

            const resultsContainer = document.getElementById('search-results');

            if (!WINDY_KEY) {
                resultsContainer.innerHTML = `
                    <div class="p-4 bg-blue-900/20 rounded-lg border border-blue-800/50 text-[10px] text-blue-300">
                        <i class="fas fa-info-circle mr-2"></i>
                        יש להזין מפתח Windy API בהגדרות כדי להשתמש בחיפוש גלובלי חופשי.
                    </div>
                `;
                return;
            }

            resultsContainer.innerHTML = '<div class="text-center p-10"><i class="fas fa-sync fa-spin"></i> Scanning...</div>';

            try {
                // שימוש ב-API של Windy (גרסה 2)
                const response = await fetch(`https://api.windy.com/api/webcams/v2/list/search=${query}?show=webcams:image,player`, {
                    headers: { 'x-windy-key': WINDY_KEY }
                });
                const data = await response.json();

                if (data.result.webcams.length === 0) {
                    resultsContainer.innerHTML = '<div class="text-center p-10 text-slate-600">No active units found.</div>';
                    return;
                }

                resultsContainer.innerHTML = data.result.webcams.map(cam => `
                    <div class="panel p-2 space-y-2 border-slate-700 hover:border-blue-500 transition group">
                        <div class="flex justify-between items-center text-[9px] font-bold text-slate-500 uppercase">
                            <span>ID: ${cam.id}</span>
                            <span class="text-blue-500">${cam.location.city || cam.location.country}</span>
                        </div>
                        <div class="aspect-video bg-black rounded overflow-hidden shadow-inner">
                             <iframe class="w-full h-full" src="${cam.player.day.embed}" frameborder="0"></iframe>
                        </div>
                        <h4 class="text-[10px] font-bold text-slate-300 truncate">${cam.title}</h4>
                    </div>
                `).join('');

            } catch (err) {
                resultsContainer.innerHTML = '<div class="text-center p-10 text-red-500 text-xs font-bold">ERROR: SCAN FAILED</div>';
            }
        }

        // --- הגדרות ---
        function openSettings() { document.getElementById('settings-modal').style.display = 'flex'; }
        function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }
        function saveSettings() {
            const key = document.getElementById('windy-key').value;
            localStorage.setItem('windy_api_key', key);
            WINDY_KEY = key;
            closeSettings();
            searchCameras();
        }

        // האזנה לחיפוש
        let debounceTimer;
        document.getElementById('cam-search').addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(searchCameras, 1000);
        });

        // --- הפעלה ---
        window.onload = () => {
            loadIsraelCams();
            if (WINDY_KEY) document.getElementById('windy-key').value = WINDY_KEY;
        };
    </script>
</body>
</html>
