<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERMINAL RADAR 3D | Global Emergency Tracker</title>
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="//unpkg.com/globe.gl"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Orbitron:wght@400;900&display=swap');
        
        body {
            background-color: #000;
            margin: 0;
            overflow: hidden;
            color: #00ff41;
            font-family: 'JetBrains Mono', monospace;
        }

        /* HUD Design */
        .hud-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 10;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .interactive { pointer-events: auto; }

        .glass-panel {
            background: rgba(0, 20, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 65, 0.2);
            box-shadow: 0 0 30px rgba(0, 0, 0, 1);
        }

        /* Scanline Effect */
        .scanline {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 255, 65, 0.02) 50%);
            background-size: 100% 4px;
            z-index: 5;
            pointer-events: none;
        }

        .orbitron { font-family: 'Orbitron', sans-serif; }

        /* Emergency Animation */
        .emergency-label {
            color: #ff0000;
            font-weight: bold;
            animation: blink 1s infinite alternate;
        }
        @keyframes blink { from { opacity: 1; } to { opacity: 0.3; } }

        /* Cinema Mode Hide */
        .cinema-mode .hide-cinema { display: none !important; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 3px; }
        ::-webkit-scrollbar-thumb { background: #00ff41; }
    </style>
</head>
<body>

    <div class="scanline"></div>
    <div id="globeViz"></div>

    <div class="hud-overlay">
        <!-- Top Header -->
        <header id="header" class="flex justify-between items-center hide-cinema">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 glass-panel rounded-xl flex items-center justify-center border-green-500/50">
                    <i class="fas fa-crosshairs animate-spin-slow text-green-400"></i>
                </div>
                <div>
                    <h1 class="orbitron text-xl font-black tracking-widest text-white">TACTICAL_RADAR_3D</h1>
                    <p class="text-[8px] uppercase tracking-[0.4em] text-green-500/60 font-bold">Orbital Surveillance Interface</p>
                </div>
            </div>

            <div class="flex items-center gap-6 interactive">
                <div class="flex gap-4 text-[10px] font-bold">
                    <button onclick="toggleAudio()" id="audioBtn" class="hover:text-white transition">
                        <i class="fas fa-volume-up"></i> AUDIO: ON
                    </button>
                    <button onclick="toggleLang()" id="langBtn" class="hover:text-white transition">
                        <i class="fas fa-language"></i> EN/注
                    </button>
                    <button onclick="toggleCinema()" class="hover:text-white transition">
                        <i class="fas fa-expand"></i> CINEMA
                    </button>
                </div>
                <div id="clock" class="orbitron text-xl text-white font-bold bg-green-950/30 px-4 py-1 rounded-lg">00:00:00</div>
            </div>
        </header>

        <!-- Sidebar Logs -->
        <main class="flex-1 flex overflow-hidden mt-6">
            <aside id="sidebar" class="w-80 glass-panel rounded-3xl flex flex-col interactive hide-cinema">
                <div class="p-4 border-b border-green-900/30 flex justify-between items-center">
                    <span class="text-[10px] font-black uppercase tracking-widest" id="ui-log-title">System_Intercepts</span>
                    <span class="text-[8px] text-red-500 animate-pulse font-bold">REAL_TIME</span>
                </div>
                <div id="log-content" class="flex-1 overflow-y-auto p-4 space-y-4 text-[9px]">
                    <div class="opacity-40 italic">> Initializing global mesh...</div>
                    <div class="opacity-40 italic">> Radar sweep initialized.</div>
                </div>
                <div class="p-4 bg-green-950/20 border-t border-green-900/30 grid grid-cols-2 gap-2 text-center">
                    <div>
                        <div class="text-[7px] uppercase opacity-60">Status</div>
                        <div class="text-[9px] font-bold text-white uppercase">Nominal</div>
                    </div>
                    <div>
                        <div class="text-[7px] uppercase opacity-60">Uplink</div>
                        <div class="text-[9px] font-bold text-blue-400 uppercase tracking-tighter">Satellite_6</div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Bottom Stats -->
        <footer id="footer" class="mt-auto flex justify-center hide-cinema">
            <div class="glass-panel px-12 py-4 rounded-full flex gap-12 interactive border-green-500/20">
                <div class="text-center">
                    <div class="text-[8px] uppercase opacity-50 font-bold" id="ui-emerg">Emergency Squawks</div>
                    <div id="count-7700" class="orbitron text-2xl text-red-500 font-black">0</div>
                </div>
                <div class="text-center border-x border-green-900/30 px-12">
                    <div class="text-[8px] uppercase opacity-50 font-bold" id="ui-planes">Global Traffic</div>
                    <div id="count-total" class="orbitron text-2xl text-green-400 font-black">0</div>
                </div>
                <div class="text-center">
                    <div class="text-[8px] uppercase opacity-50 font-bold" id="ui-seismic">Seismic Events</div>
                    <div id="count-quake" class="orbitron text-2xl text-orange-400 font-black">0</div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // --- System State ---
        let currentLang = 'en';
        let audioEnabled = true;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        const i18n = {
            en: { log: "System_Intercepts", emerg: "Emergency Squawks", planes: "Global Traffic", seismic: "Seismic Events", dir: "ltr" },
            he: { log: "专_注专转", emerg: "住 专", planes: "转注 注转", seismic: "专注 住住", dir: "rtl" }
        };

        // --- 3D Globe Init ---
        const world = Globe()
            (document.getElementById('globeViz'))
            .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
            .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
            .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
            .pointColor(() => '#00ff41')
            .pointAltitude(0.05)
            .pointRadius(0.1)
            .arcColor(() => '#ff0000')
            .arcDashLength(0.4)
            .arcDashGap(4)
            .arcDashAnimateTime(1000);

        // Auto-rotate
        world.controls().autoRotate = true;
        world.controls().autoRotateSpeed = 0.5;

        // --- Audio SFX ---
        function playPing() {
            if (!audioEnabled) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.5);
        }

        // --- Data Fetching ---
        async function updateRadar() {
            try {
                // 1. Aircraft Data (OpenSky)
                const planeRes = await fetch('https://opensky-network.org/api/states/all');
                const planeData = await planeRes.json();
                const allStates = planeData.states || [];
                const emergencies = allStates.filter(s => s[14] === "7700");

                document.getElementById('count-total').innerText = allStates.length.toLocaleString();
                document.getElementById('count-7700').innerText = emergencies.length;

                // Visualize Emergencies as Arcs/Points
                const emergencyPoints = emergencies.map(p => ({
                    lat: p[6],
                    lng: p[5],
                    size: 1.5,
                    color: 'red',
                    label: ` SQUAWK 7700: ${p[1]}`
                }));

                if (emergencies.length > 0) {
                    playPing();
                    emergencies.forEach(p => addLog(`CRITICAL: Flight ${p[1]} reporting Emergency (Squawk 7700)`, 'red'));
                }

                // 2. Earthquakes (USGS)
                const qRes = await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_day.geojson');
                const qData = await qRes.json();
                
                document.getElementById('count-quake').innerText = qData.features.length;
                
                const quakes = qData.features.map(f => ({
                    lat: f.geometry.coordinates[1],
                    lng: f.geometry.coordinates[0],
                    size: f.properties.mag / 2,
                    color: 'orange',
                    label: `QUAKE: Mag ${f.properties.mag} - ${f.properties.place}`
                }));

                world.pointsData([...emergencyPoints, ...quakes]);
                world.pointLabel('label');

            } catch (e) {
                console.error("Link unstable.");
            }
        }

        // --- UI Logic ---
        function addLog(msg, color = 'green') {
            const container = document.getElementById('log-content');
            const time = new Date().toLocaleTimeString().split(' ')[0];
            const div = document.createElement('div');
            div.className = color === 'red' ? 'text-red-500 font-bold' : 'text-green-400 opacity-80';
            div.innerHTML = `> [${time}] ${msg}`;
            container.prepend(div);
            if (container.children.length > 50) container.removeChild(container.lastChild);
        }

        function toggleAudio() {
            audioEnabled = !audioEnabled;
            document.getElementById('audioBtn').innerHTML = audioEnabled ? '<i class="fas fa-volume-up"></i> AUDIO: ON' : '<i class="fas fa-volume-mute"></i> AUDIO: OFF';
            if (audioEnabled) audioCtx.resume();
        }

        function toggleLang() {
            currentLang = currentLang === 'en' ? 'he' : 'en';
            const data = i18n[currentLang];
            document.body.dir = data.dir;
            document.getElementById('ui-log-title').innerText = data.log;
            document.getElementById('ui-emerg').innerText = data.emerg;
            document.getElementById('ui-planes').innerText = data.planes;
            document.getElementById('ui-seismic').innerText = data.seismic;
        }

        function toggleCinema() {
            document.body.classList.toggle('cinema-mode');
        }

        // --- Loops ---
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB');
        }, 1000);

        updateRadar();
        setInterval(updateRadar, 60000); // 专注  拽

        // Resize Fix
        window.addEventListener('resize', () => world.width(window.innerWidth).height(window.innerHeight));
    </script>
</body>
</html>
