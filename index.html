<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Market Terminal | Top 10 Analysis</title>
    
    <!-- Scripts & Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@200;400;700;800&family=JetBrains+Mono&display=swap');
        
        :root {
            --nvda-green: #76b900;
            --market-blue: #3b82f6;
            --bg-dark: #0a0a0f;
            --panel-bg: rgba(22, 22, 29, 0.8);
        }

        body {
            background-color: var(--bg-dark);
            color: #e2e8f0;
            font-family: 'Assistant', sans-serif;
            overflow-x: hidden;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .signal-glow-buy { box-shadow: 0 0 20px rgba(16, 185, 129, 0.2); border-top: 4px solid #10b981; }
        .signal-glow-sell { box-shadow: 0 0 20px rgba(244, 63, 94, 0.2); border-top: 4px solid #f43f5e; }
        .signal-glow-hold { box-shadow: 0 0 20px rgba(148, 163, 184, 0.1); border-top: 4px solid #94a3b8; }

        select {
            background: #1a1a24;
            border: 1px solid #3b82f6;
            color: white;
            cursor: pointer;
        }

        .cinema-mode .hide-cinema { display: none !important; }
    </style>
</head>
<body class="p-4 md:p-6 transition-all duration-500">

    <div class="max-w-7xl mx-auto">
        
        <!-- Header Section -->
        <header class="hide-cinema flex flex-col md:flex-row justify-between items-center mb-8 gap-6 glass-panel p-6 rounded-[2rem]">
            <div class="flex items-center gap-5">
                <div class="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg shadow-blue-900/20">
                    <i class="fas fa-chart-line text-3xl text-white"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-black uppercase tracking-tighter italic">Strategic <span class="text-blue-500">Terminal</span></h1>
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Global Market Intelligence Hub v2.0</p>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <!-- Company Selector -->
                <div class="flex flex-col">
                    <span class="text-[9px] font-black text-slate-500 uppercase mb-1 mr-1">Select Asset</span>
                    <select id="ticker-select" onchange="loadData(this.value)" class="px-6 py-2.5 rounded-xl font-black text-sm outline-none shadow-xl transition-all hover:border-white">
                        <option value="nvda">NVIDIA (NVDA)</option>
                        <option value="aapl">APPLE (AAPL)</option>
                        <option value="msft">MICROSOFT (MSFT)</option>
                        <option value="googl">ALPHABET (GOOGL)</option>
                        <option value="amzn">AMAZON (AMZN)</option>
                        <option value="meta">META (META)</option>
                        <option value="tsla">TESLA (TSLA)</option>
                        <option value="brk-b">BERKSHIRE (BRK-B)</option>
                        <option value="lly">ELI LILLY (LLY)</option>
                        <option value="avgo">BROADCOM (AVGO)</option>
                    </select>
                </div>
                
                <button onclick="toggleCinema()" class="p-3 bg-slate-800 rounded-xl hover:bg-slate-700 transition" title="Cinema Mode">
                    <i class="fas fa-expand-arrows-alt"></i>
                </button>
            </div>
        </header>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Sidebar Stats (4 Cols) -->
            <div class="lg:col-span-4 flex flex-col gap-6">
                <!-- RECOMMENDATION CARD -->
                <div id="signal-card" class="glass-panel p-10 rounded-[2.5rem] text-center transition-all duration-700 signal-glow-hold">
                    <div class="text-[10px] font-black text-slate-500 uppercase mb-6 tracking-[0.3em]">Decision_Engine</div>
                    <div id="signal-text" class="text-7xl font-black mb-4 italic tracking-tighter uppercase">---</div>
                    <div id="signal-desc" class="text-sm text-slate-400 font-medium leading-relaxed">טוען נתונים היסטוריים...</div>
                </div>

                <!-- QUICK DATA -->
                <div class="glass-panel p-8 rounded-[2rem] space-y-5">
                    <div class="flex justify-between items-end border-b border-white/5 pb-4">
                        <span class="text-xs font-bold text-slate-500 uppercase">Current Price</span>
                        <b id="price" class="text-3xl font-black mono text-white">---</b>
                    </div>
                    <div class="flex justify-between items-center border-b border-white/5 pb-4">
                        <span class="text-xs font-bold text-slate-500 uppercase">RSI (14D)</span>
                        <b id="rsi-val" class="text-xl font-bold mono">---</b>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold text-slate-500 uppercase">SMA200 Distance</span>
                        <b id="sma-dist" class="text-xl font-bold mono">---</b>
                    </div>
                    <div id="update-time" class="text-[9px] text-slate-600 text-center uppercase pt-2 font-mono"></div>
                </div>
            </div>

            <!-- Main Chart Area (8 Cols) -->
            <div class="lg:col-span-8 flex flex-col gap-6">
                <div class="glass-panel p-8 rounded-[3rem] h-full flex flex-col">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h2 id="company-name-display" class="text-2xl font-black text-white">---</h2>
                            <p id="asset-symbol" class="text-xs font-bold text-blue-500 uppercase tracking-widest mt-1">---</p>
                        </div>
                        <div class="flex gap-2">
                            <span class="bg-blue-600/10 text-blue-400 text-[9px] font-black px-3 py-1 rounded-full border border-blue-500/20 uppercase">Data_Source: Python_Crawler</span>
                        </div>
                    </div>
                    <div class="flex-1 min-h-[400px] relative">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
            </div>

        </div>

        <!-- Footer Notification -->
        <footer class="hide-cinema mt-8 text-center">
            <p class="text-[9px] text-slate-600 uppercase font-black tracking-[0.5em]">System Status: Connected // All Nodes Operational</p>
        </footer>
    </div>

    <script>
        let myChart = null;
        let currentSymbol = 'nvda';

        // --- Data Fetching ---
        async function loadData(symbol) {
            currentSymbol = symbol;
            try {
                // נתיב הקובץ בתוך תיקיית data
                const res = await fetch(`data/${symbol}_data.json?v=${Date.now()}`);
                if (!res.ok) throw new Error("File not available");
                
                const data = await res.json();
                updateUI(data);
            } catch (e) {
                document.getElementById('signal-text').innerText = "WAIT";
                document.getElementById('signal-desc').innerText = "ממתין לסנכרון נתונים ראשוני בגיטהאב (תיקיית data)...";
                console.error(e);
            }
        }

        // --- UI Logic ---
        function updateUI(data) {
            const meta = data.metadata;
            const history = data.history;
            const last = history[history.length - 1];

            // Text Updates
            document.getElementById('company-name-display').innerText = meta.name;
            document.getElementById('asset-symbol').innerText = `Ticker: ${meta.symbol}`;
            document.getElementById('price').innerText = `$${meta.current_price.toLocaleString()}`;
            document.getElementById('rsi-val').innerText = meta.rsi.toFixed(2);
            document.getElementById('update-time').innerText = "Last Database Sync: " + meta.last_updated;

            // SMA200 Distance Calculation
            const sma200 = last.SMA200;
            const dist = (((meta.current_price - sma200) / sma200) * 100).toFixed(1);
            const smaEl = document.getElementById('sma-dist');
            smaEl.innerText = (dist > 0 ? '+' : '') + dist + "%";
            smaEl.className = `text-xl font-bold mono ${dist > 0 ? 'text-emerald-500' : 'text-rose-500'}`;

            // DECISION ENGINE
            const sig = document.getElementById('signal-text');
            const desc = document.getElementById('signal-desc');
            const card = document.getElementById('signal-card');

            card.classList.remove('signal-glow-buy', 'signal-glow-sell', 'signal-glow-hold');

            if(meta.rsi <= 35) {
                sig.innerText = "BUY"; 
                sig.className = "text-7xl font-black mb-4 text-emerald-500 italic";
                desc.innerText = "המניה במצב מכירת יתר (Oversold). פוטנציאל כניסה טכני גבוה.";
                card.classList.add('signal-glow-buy');
            } else if(meta.rsi >= 70) {
                sig.innerText = "SELL"; 
                sig.className = "text-7xl font-black mb-4 text-rose-500 italic";
                desc.innerText = "המניה במצב קניית יתר (Overbought). רמת סיכון גבוהה לתיקון.";
                card.classList.add('signal-glow-sell');
            } else {
                sig.innerText = "HOLD"; 
                sig.className = "text-7xl font-black mb-4 text-slate-500 italic";
                desc.innerText = "המניה נסחרת בטווח הממוצע. המתן לאיתות קצה (RSI < 35 או > 70).";
                card.classList.add('signal-glow-hold');
            }

            renderChart(history, meta.symbol);
        }

        // --- Charting ---
        function renderChart(history, symbol) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if(myChart) myChart.destroy();
            
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map(h => h.Datetime),
                    datasets: [
                        {
                            label: 'Price',
                            data: history.map(h => h.Close),
                            borderColor: '#3b82f6',
                            borderWidth: 3,
                            pointRadius: 0,
                            fill: true,
                            backgroundColor: 'rgba(59, 130, 246, 0.05)',
                            tension: 0.2
                        },
                        {
                            label: 'SMA200',
                            data: history.map(h => h.SMA200),
                            borderColor: '#f59e0b',
                            borderWidth: 1.5,
                            pointRadius: 0,
                            fill: false,
                            borderDash: [5, 5],
                            opacity: 0.5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false },
                        y: { 
                            grid: { color: 'rgba(255, 255, 255, 0.03)' },
                            ticks: { color: '#64748b', font: { size: 10, family: 'JetBrains Mono' } }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#1e1e2e',
                            titleFont: { size: 12, family: 'Assistant' },
                            bodyFont: { size: 12, family: 'JetBrains Mono' }
                        }
                    }
                }
            });
        }

        // --- Helpers ---
        function toggleCinema() {
            document.body.classList.toggle('cinema-mode');
            setTimeout(() => { if(myChart) myChart.resize(); }, 300);
        }

        // Clock Update
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB');
        }, 1000);

        // First Load
        window.onload = () => loadData('nvda');
    </script>
</body>
</html>
